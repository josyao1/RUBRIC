================================================================================
                            GradeMate - Project Plan
                  AI-Powered Constructive Feedback for Educators
================================================================================

--------------------------------------------------------------------------------
1. PROJECT OVERVIEW
--------------------------------------------------------------------------------

GradeMate is a web-based application that enables educators to:
  - Create and manage feedback rubrics
  - Upload student submissions (essays, code, reports, etc.)
  - Generate AI-powered CONSTRUCTIVE FEEDBACK (not just grades)
  - Provide INLINE COMMENTS on specific parts of student work
  - Synthesize feedback organized by rubric sections
  - Help students improve through actionable, specific guidance

*** KEY INSIGHT: This is NOT a grading tool. It's a FEEDBACK tool. ***
The goal is productive, constructive feedback that helps students grow.

Target Users: K-12 teachers, university professors, TAs, instructors

--------------------------------------------------------------------------------
2. CORE FEATURES (MVP)
--------------------------------------------------------------------------------

================================================================================
  IMPLEMENTATION PRIORITY ORDER:

    1. RUBRIC UPLOAD PIPELINE      <- Teachers upload existing rubrics
    2. STUDENT WORK PIPELINE       <- Upload student submissions
    3. FEEDBACK PIPELINE           <- AI generates constructive feedback

  Everything else is secondary/supporting infrastructure.
================================================================================

Phase 1: Foundation
  [ ] User authentication (teacher accounts)
  [ ] Class/course management
  [ ] Assignment creation

Phase 2: Rubric Upload Pipeline  [PRIORITY 1]
  [ ] File upload for rubrics (PDF, DOCX, Excel/CSV, images)
  [ ] AI parsing to extract criteria, descriptions, expectations
  [ ] Teacher review/confirm extracted rubric structure
  [ ] Manual rubric builder as fallback/editing tool
  [ ] Rubric versioning and reuse across assignments

Phase 3: Student Work Pipeline  [PRIORITY 2]
  [ ] File upload system (PDF, DOCX, TXT, code files)
  [ ] Bulk upload via ZIP
  [ ] Student roster management (manual entry or CSV import)
  [ ] Submission status tracking
  [ ] Support for various submission types (essays, code, reports)

Phase 4: Feedback Pipeline  [PRIORITY 3]
  [ ] AI API integration (OpenAI/Anthropic)
  [ ] INLINE COMMENTS: Specific feedback on exact parts of submission
  [ ] RUBRIC-SECTION FEEDBACK: Synthesized feedback per criterion
  [ ] OVERALL SYNTHESIS: Constructive summary with actionable next steps
  [ ] Batch processing for multiple submissions
  [ ] Teacher review/edit before releasing to students

Phase 5: Review & Distribution
  [ ] Teacher review interface (edit AI feedback before release)
  [ ] Export feedback reports
  [ ] Student portal (view feedback)
  [ ] Student follow-up conversations (ask questions on any comment)
  [ ] Context-aware LLM responses (rubric + submission + comment context)

--------------------------------------------------------------------------------
3. FEEDBACK MODEL (CRITICAL)
--------------------------------------------------------------------------------

*** THIS IS THE CORE VALUE PROPOSITION ***

When a student submits work (e.g., an essay), GradeMate produces:

┌─────────────────────────────────────────────────────────────────────────────┐
│  FEEDBACK STRUCTURE                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. INLINE COMMENTS (like Google Docs)                                      │
│     - Attached to specific sentences/paragraphs/lines                       │
│     - Example: Highlight "The war started because..." with comment:         │
│       "Consider adding a specific date or event to strengthen this claim"   │
│     - Stored as: { start: 45, end: 72, comment: "...", criterion: "..." }   │
│                                                                             │
│  2. RUBRIC-SECTION FEEDBACK (at the end)                                    │
│     For each rubric criterion, provide:                                     │
│     ┌─────────────────────────────────────────────────────────────────┐     │
│     │  THESIS STATEMENT                                               │     │
│     │  ─────────────────────────────────────────────────────────────  │     │
│     │  Strengths:                                                     │     │
│     │  • Your thesis clearly states your position on X                │     │
│     │  • Good use of argumentative language                           │     │
│     │                                                                 │     │
│     │  Areas for Growth:                                              │     │
│     │  • Consider making your thesis more specific by...              │     │
│     │  • Try to address the counterargument in your thesis            │     │
│     │                                                                 │     │
│     │  Suggestions:                                                   │     │
│     │  • Revise to: "While X, this essay argues Y because Z"          │     │
│     └─────────────────────────────────────────────────────────────────┘     │
│     (Repeat for each rubric section: Evidence, Organization, etc.)          │
│                                                                             │
│  3. OVERALL SYNTHESIS                                                       │
│     - Summary of key strengths across all criteria                          │
│     - Top 2-3 priority areas for improvement                                │
│     - Encouraging, growth-oriented tone                                     │
│     - Actionable next steps                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

--------------------------------------------------------------------------------
4. TECHNICAL ARCHITECTURE
--------------------------------------------------------------------------------

Frontend:
  - Framework: React + TypeScript
  - UI Library: Tailwind CSS
  - State Management: React Context or Zustand
  - File Handling: react-dropzone
  - Document Viewer: Custom component with inline comment support

Backend:
  - Framework: Node.js + Express
  - Database: SQLite (local) / PostgreSQL (production)
  - File Processing: Multer
  - PDF Parsing: pdf-parse
  - DOCX Parsing: mammoth.js

Database Schema:
  rubrics
    - id, user_id, name, description, created_at

  criteria
    - id, rubric_id, name, description, order

  submissions
    - id, assignment_id, student_id, file_path, extracted_text, status

  inline_comments
    - id, submission_id, criterion_id
    - start_position, end_position (character offsets in text)
    - highlighted_text (the actual text being commented on)
    - comment (the feedback)

  section_feedback
    - id, submission_id, criterion_id
    - strengths (text/JSON array)
    - areas_for_growth (text/JSON array)
    - suggestions (text/JSON array)

  overall_feedback
    - id, submission_id
    - summary, priority_improvements, next_steps

  comment_threads (for student follow-up questions)
    - id, inline_comment_id, created_at

  thread_messages
    - id, thread_id, role ('student'|'assistant'), content, created_at

AI Integration:
  - Provider: Anthropic Claude API (or OpenAI GPT-4)
  - Prompt engineering for constructive, growth-oriented feedback
  - Structured output for inline comments + section feedback

--------------------------------------------------------------------------------
5. UI STRUCTURE & WIREFRAMES
--------------------------------------------------------------------------------

Navigation (Sidebar):
  +---------------------------+
  |  [Logo] GradeMate         |
  +---------------------------+
  |  Dashboard                |
  |  Rubrics                  |
  |  Assignments              |
  |  Submissions              |
  |  Feedback Review          |
  |  Settings                 |
  +---------------------------+

A. FEEDBACK REVIEW INTERFACE (Most Important Screen)

  +-----------------------------------------------------------------------+
  |  Feedback: John Smith - Midterm Essay              [Prev] [Next]      |
  +-----------------------------------------------------------------------+
  |                                                                       |
  |  +-----------------------------+  +-------------------------------+   |
  |  | STUDENT SUBMISSION          |  | FEEDBACK PANEL                |   |
  |  | (with inline comments)      |  |                               |   |
  |  |                             |  | [Inline Comments Tab]         |   |
  |  | "The Civil War started      |  | [Rubric Feedback Tab]         |   |
  |  |  [1] because of economic    |  | [Overall Tab]                 |   |
  |  |  differences between..."    |  |                               |   |
  |  |                             |  | ─────────────────────────     |   |
  |  | "Lincoln believed that      |  | THESIS STATEMENT              |   |
  |  |  [2] slavery was wrong..."  |  |                               |   |
  |  |                             |  | Strengths:                    |   |
  |  |  [Highlighted sections      |  | • Clear position stated       |   |
  |  |   show where comments       |  |                               |   |
  |  |   are attached]             |  | Areas for Growth:             |   |
  |  |                             |  | • Add specific scope          |   |
  |  |                             |  |                               |   |
  |  |                             |  | ─────────────────────────     |   |
  |  |                             |  | EVIDENCE & SUPPORT            |   |
  |  |                             |  | ...                           |   |
  |  +-----------------------------+  +-------------------------------+   |
  |                                                                       |
  |  [Edit Feedback]  [Approve & Release to Student]                      |
  +-----------------------------------------------------------------------+

B. INLINE COMMENT INTERACTION

  When teacher/AI highlights text:
  +------------------------------------------+
  |  "The war started because of economic"   |  <-- highlighted
  +------------------------------------------+
           |
           v
  +------------------------------------------+
  |  Add Comment                             |
  |  ────────────────────────────────────    |
  |  Linked to: [Thesis v] (dropdown)        |
  |  Comment: [________________________]     |
  |           [________________________]     |
  |  [Cancel]  [Save Comment]                |
  +------------------------------------------+

--------------------------------------------------------------------------------
6. AI FEEDBACK PROMPT TEMPLATE
--------------------------------------------------------------------------------

```
You are an experienced, supportive educator providing constructive feedback
on student work. Your goal is to help the student IMPROVE, not just to judge.

RUBRIC CRITERIA:
{rubric_criteria_with_descriptions}

STUDENT SUBMISSION:
{extracted_text}

Provide feedback in the following JSON structure:

{
  "inline_comments": [
    {
      "highlighted_text": "exact text from submission",
      "start_position": 0,
      "end_position": 25,
      "criterion": "Thesis Statement",
      "comment": "Consider strengthening this by..."
    }
  ],
  "section_feedback": [
    {
      "criterion": "Thesis Statement",
      "strengths": ["Clear position", "Argumentative tone"],
      "areas_for_growth": ["Could be more specific"],
      "suggestions": ["Try: 'While X argues Y, this essay contends Z'"]
    }
  ],
  "overall_feedback": {
    "summary": "This essay demonstrates strong understanding of...",
    "top_priorities": ["Focus on X", "Develop Y further"],
    "encouragement": "You're making great progress on...",
    "next_steps": ["For your next draft, try..."]
  }
}

IMPORTANT GUIDELINES:
- Be specific: Reference exact parts of the student's work
- Be constructive: Frame feedback as opportunities for growth
- Be actionable: Give concrete suggestions, not vague criticism
- Be encouraging: Acknowledge what's working well
- Aim for 5-10 inline comments spread across the submission
- Provide 2-3 strengths and 2-3 growth areas per rubric section
```

--------------------------------------------------------------------------------
7. DEVELOPMENT PHASES & MILESTONES
--------------------------------------------------------------------------------

PHASE 0: Project Setup (Foundation) [DONE]
  - Initialize React frontend with Vite + TypeScript
  - Set up Express/Node backend
  - Configure SQLite database
  - Create basic layout with sidebar navigation

================================================================================
  PRIORITY IMPLEMENTATION ORDER
================================================================================

PHASE 1: RUBRIC UPLOAD PIPELINE  [PRIORITY 1]
  - File upload endpoint for rubrics
  - Text extraction from uploaded files
  - Manual rubric builder
  - Save rubrics to database

PHASE 2: STUDENT WORK UPLOAD PIPELINE  [PRIORITY 2]
  - File upload endpoint for submissions
  - Text extraction and storage
  - Bulk upload support
  - Student matching

PHASE 3: FEEDBACK PIPELINE  [PRIORITY 3]
  - Document viewer with highlighting support
  - Inline comment system (add/edit/delete)
  - Rubric-section feedback panels
  - Overall feedback synthesis
  - AI integration for auto-generating feedback
  - Teacher review/edit workflow

================================================================================
  SECONDARY PHASES
================================================================================

PHASE 4: Polish & Distribution
  - Feedback export (PDF report)
  - Student portal for viewing feedback
  - Email notifications
  - Analytics dashboard

--------------------------------------------------------------------------------
8. STUDENT INTERACTION & FOLLOW-UP CONVERSATIONS
--------------------------------------------------------------------------------

Students can interact with feedback by asking follow-up questions on any comment.
This creates a threaded, context-aware conversation powered by LLM.

INTERACTION FLOW:
  ┌─────────────────────────────────────────────────────────────────────────┐
  │  INLINE COMMENT (from AI/Teacher)                                       │
  │  ─────────────────────────────────────────────────────────────────────  │
  │  "Consider adding a specific date or event to strengthen this claim."   │
  │                                                                         │
  │  [Ask a question...]                                                    │
  │                                                                         │
  │  ─── Conversation Thread ───                                            │
  │                                                                         │
  │  Student: "What kind of date would work here? I'm not sure what         │
  │            events are relevant to this argument."                       │
  │                                                                         │
  │  AI: "Great question! Since you're discussing the economic causes       │
  │       of the Civil War, you could reference:                            │
  │       • The Tariff of 1828 ("Tariff of Abominations")                   │
  │       • The Panic of 1857                                               │
  │       • The publication of 'The Impending Crisis' (1857)                │
  │       Any of these would ground your claim in historical fact."         │
  │                                                                         │
  │  Student: "Thanks! Would the Tariff of 1828 work even though it's       │
  │            30+ years before the war?"                                   │
  │                                                                         │
  │  AI: "Yes! In fact, referencing earlier events shows the long           │
  │       build-up of tensions. You could write: 'Economic divisions,       │
  │       evident as early as the Tariff of 1828, festered for decades...'  │
  │       This demonstrates historical depth."                              │
  │                                                                         │
  └─────────────────────────────────────────────────────────────────────────┘

CONTEXT PROVIDED TO AI FOR FOLLOW-UP:
  {
    "conversation_context": {
      "rubric": { ... },                    // Full rubric for reference
      "criterion": "Thesis Statement",      // Which rubric section
      "submission_excerpt": "...",          // Relevant part of submission
      "full_submission": "...",             // Full text if needed
      "original_comment": "...",            // The feedback being discussed
      "conversation_history": [             // Previous messages in thread
        { "role": "student", "content": "..." },
        { "role": "assistant", "content": "..." }
      ]
    }
  }

DATABASE ADDITIONS:
  comment_threads
    - id
    - inline_comment_id (links to the original comment)
    - created_at

  thread_messages
    - id
    - thread_id
    - role ('student' | 'assistant')
    - content
    - created_at

UI REQUIREMENTS:
  - Each inline comment has an expandable thread
  - Student types question, hits send
  - AI responds with context-aware guidance
  - Teacher can view all student conversations (optional)
  - Conversation stays focused on that specific feedback point

AI GUIDELINES FOR FOLLOW-UP:
  - Stay focused on the specific comment/criterion
  - Be helpful and educational, not just give answers
  - Guide student toward improvement, don't rewrite for them
  - Reference their actual submission when relevant
  - Keep responses concise but thorough

--------------------------------------------------------------------------------
9. DATA FLOW
--------------------------------------------------------------------------------

1. Teacher uploads rubric
   └─> Extracted & stored in database

2. Teacher uploads student submission
   └─> Text extracted & stored

3. Teacher clicks "Generate Feedback"
   └─> AI analyzes submission against rubric
   └─> Returns: inline comments + section feedback + overall synthesis

4. Teacher reviews AI feedback
   └─> Can edit/add/remove comments
   └─> Can modify section feedback

5. Teacher approves & releases
   └─> Feedback visible to student (future: student portal)

--------------------------------------------------------------------------------
10. KEY DIFFERENCES FROM GRADING TOOLS
--------------------------------------------------------------------------------

| Grading Tools              | GradeMate (Feedback Tool)              |
|----------------------------|----------------------------------------|
| Focus on SCORES            | Focus on IMPROVEMENT                   |
| "You got 85/100"           | "Here's how to make this stronger"     |
| Summary judgment           | Specific, actionable inline comments   |
| End-of-document only       | Inline + per-section + overall         |
| Evaluative tone            | Constructive, growth-oriented tone     |
| Student sees a number      | Student sees a roadmap for improvement |

--------------------------------------------------------------------------------
11. NEXT STEPS
--------------------------------------------------------------------------------

1. [x] Project scaffolding
2. [x] Basic UI with navigation
3. [ ] Rubric upload/builder (functional)
4. [ ] Submission upload with text extraction
5. [ ] Document viewer component with text selection
6. [ ] Inline comment system
7. [ ] Section feedback panels
8. [ ] AI integration for feedback generation
9. [ ] Teacher review workflow
10. [ ] Student-facing feedback view
11. [ ] Student follow-up conversations on comments (LLM-powered)

================================================================================
                              END OF PLAN
================================================================================
