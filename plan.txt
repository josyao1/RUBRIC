================================================================================
                              RUBRIC - Project Plan
                     AI-Powered Grading Assistant for Educators
================================================================================

--------------------------------------------------------------------------------
1. PROJECT OVERVIEW
--------------------------------------------------------------------------------

RUBRIC is a web-based application that enables educators to:
  - Create and manage grading rubrics
  - Upload student submissions (essays, code, reports, etc.)
  - Leverage AI to automatically grade against rubric criteria
  - Generate individualized, criterion-specific feedback
  - Distribute grades and feedback to students

Target Users: K-12 teachers, university professors, TAs, instructors

--------------------------------------------------------------------------------
2. CORE FEATURES (MVP)
--------------------------------------------------------------------------------

================================================================================
  IMPLEMENTATION PRIORITY ORDER:

    1. RUBRIC UPLOAD PIPELINE    <- Teachers upload existing rubrics
    2. STUDENT WORK PIPELINE     <- Upload student submissions
    3. GRADING PIPELINE          <- AI grades against rubric

  Everything else is secondary/supporting infrastructure.
================================================================================

Phase 1: Foundation
  [ ] User authentication (teacher accounts)
  [ ] Class/course management
  [ ] Assignment creation

Phase 2: Rubric Upload Pipeline  [PRIORITY 1]
  [ ] File upload for rubrics (PDF, DOCX, Excel/CSV, images)
  [ ] AI parsing to extract criteria, descriptions, point values
  [ ] Teacher review/confirm extracted rubric structure
  [ ] Manual rubric builder as fallback/editing tool
  [ ] Rubric versioning and reuse across assignments

Phase 3: Student Work Pipeline  [PRIORITY 2]
  [ ] File upload system (PDF, DOCX, TXT, code files)
  [ ] Bulk upload via ZIP
  [ ] Student roster management (manual entry or CSV import)
  [ ] Submission status tracking
  [ ] Support for various submission types (essays, code, reports)

Phase 4: Grading Pipeline  [PRIORITY 3]
  [ ] AI API integration (OpenAI/Anthropic)
  [ ] Rubric-to-prompt engineering
  [ ] Per-criterion scoring with justification
  [ ] Overall feedback generation
  [ ] Confidence scoring for flagging edge cases
  [ ] Batch/queue processing for multiple submissions

Phase 5: Review & Distribution
  [ ] Teacher review interface (approve/edit AI grades)
  [ ] Grade override capability
  [ ] Export to CSV/Excel
  [ ] Email distribution (optional)
  [ ] Student portal (future consideration)

--------------------------------------------------------------------------------
3. TECHNICAL ARCHITECTURE
--------------------------------------------------------------------------------

Frontend:
  - Framework: React + TypeScript
  - UI Library: Tailwind CSS + shadcn/ui (professional, accessible)
  - State Management: React Context or Zustand
  - File Handling: react-dropzone

Backend:
  - Framework: Node.js + Express (or Python FastAPI)
  - Authentication: JWT + bcrypt
  - File Processing: Multer (Node) or python-multipart
  - PDF Parsing: pdf-parse / PyPDF2
  - DOCX Parsing: mammoth.js / python-docx

Database:
  - PostgreSQL (relational data: users, classes, rubrics, grades)
  - Schema tables:
      * users (id, email, password_hash, name, created_at)
      * classes (id, user_id, name, term, created_at)
      * students (id, class_id, name, email, student_id)
      * rubrics (id, user_id, name, description, created_at)
      * criteria (id, rubric_id, name, description, max_points, order)
      * assignments (id, class_id, rubric_id, name, due_date)
      * submissions (id, assignment_id, student_id, file_path, status)
      * grades (id, submission_id, criterion_id, score, feedback)
      * overall_feedback (id, submission_id, total_score, summary)

AI Integration:
  - Provider: Anthropic Claude API (or OpenAI GPT-4)
  - Rate limiting and queue system for bulk grading
  - Prompt template system for consistent grading

--------------------------------------------------------------------------------
4. UI STRUCTURE & WIREFRAMES
--------------------------------------------------------------------------------

Navigation (Sidebar):
  +---------------------------+
  |  [Logo] RUBRIC            |
  +---------------------------+
  |  Dashboard                |
  |  Classes                  |
  |  Rubrics                  |
  |  Assignments              |
  |  Grade Center             |
  |  Settings                 |
  +---------------------------+
  |  [User Avatar] Profile    |
  +---------------------------+

Page Layouts:

A. DASHBOARD
   +---------------------------------------------------------------+
   |  Welcome, [Teacher Name]                                      |
   +---------------------------------------------------------------+
   |  Quick Stats                                                  |
   |  +-------------+  +-------------+  +-------------+            |
   |  | 12 Classes  |  | 45 Pending  |  | 230 Graded  |            |
   |  +-------------+  +-------------+  +-------------+            |
   +---------------------------------------------------------------+
   |  Recent Activity              |  Upcoming Due Dates           |
   |  - Graded Essay #3 (2h ago)   |  - Midterm Essay (Oct 15)     |
   |  - New submission (3h ago)    |  - Lab Report 4 (Oct 18)      |
   +---------------------------------------------------------------+

B. RUBRIC BUILDER
   +---------------------------------------------------------------+
   |  Create New Rubric                              [Save] [Cancel]|
   +---------------------------------------------------------------+
   |  Name: [________________________]                              |
   |  Description: [______________________________________________] |
   +---------------------------------------------------------------+
   |  Criteria                                          [+ Add Row] |
   +---------------------------------------------------------------+
   |  #  | Criterion Name | Description        | Max Points         |
   +-----+----------------+--------------------+--------------------+
   |  1  | [Thesis      ] | [Clear argument..] | [20]    [Delete]   |
   |  2  | [Evidence    ] | [Supporting det..] | [25]    [Delete]   |
   |  3  | [Organization] | [Logical flow...] | [20]    [Delete]   |
   |  4  | [Grammar     ] | [Spelling, punc..] | [15]    [Delete]   |
   |  5  | [Citations   ] | [Proper format..]  | [20]    [Delete]   |
   +-----+----------------+--------------------+--------------------+
   |                                          Total: 100 points     |
   +---------------------------------------------------------------+

C. ASSIGNMENT VIEW
   +---------------------------------------------------------------+
   |  Assignment: Midterm Essay          Class: English 101        |
   |  Due: Oct 15, 2024                  Rubric: Essay Rubric v2   |
   +---------------------------------------------------------------+
   |  [Upload Submissions]  [Grade All]  [Export Grades]           |
   +---------------------------------------------------------------+
   |  Submissions (24/30 received)                                 |
   +---------------------------------------------------------------+
   |  Student Name    | Status     | Score   | Actions             |
   +-----------------+------------+---------+---------------------+
   |  Alice Johnson   | Graded     | 92/100  | [View] [Edit]       |
   |  Bob Smith       | Pending    | --      | [Grade]             |
   |  Carol Williams  | In Review  | 85/100  | [View] [Approve]    |
   +-----------------+------------+---------+---------------------+

D. GRADING INTERFACE
   +---------------------------------------------------------------+
   |  Grading: Bob Smith - Midterm Essay           [Prev] [Next]   |
   +---------------------------------------------------------------+
   |  +---------------------------+  +---------------------------+ |
   |  | STUDENT SUBMISSION        |  | RUBRIC SCORING            | |
   |  | [PDF/Doc Viewer]          |  |                           | |
   |  |                           |  | Thesis (20 pts)           | |
   |  |                           |  | Score: [18] / 20          | |
   |  |                           |  | Feedback: [AI generated.. | |
   |  |                           |  | ________________________] | |
   |  |                           |  |                           | |
   |  |                           |  | Evidence (25 pts)         | |
   |  |                           |  | Score: [22] / 25          | |
   |  |                           |  | Feedback: [______________]| |
   |  |                           |  |                           | |
   |  |                           |  | [... more criteria ...]   | |
   |  +---------------------------+  +---------------------------+ |
   +---------------------------------------------------------------+
   |  Overall Feedback:                                            |
   |  [_________________________________________________________] |
   |  Total Score: 85/100                    [Save Draft] [Submit] |
   +---------------------------------------------------------------+

--------------------------------------------------------------------------------
5. FILE STRUCTURE (SKELETON)
--------------------------------------------------------------------------------

rubric/
├── frontend/
│   ├── public/
│   │   └── index.html
│   ├── src/
│   │   ├── components/
│   │   │   ├── ui/                    # Reusable UI components
│   │   │   │   ├── Button.tsx
│   │   │   │   ├── Card.tsx
│   │   │   │   ├── Input.tsx
│   │   │   │   ├── Modal.tsx
│   │   │   │   ├── Table.tsx
│   │   │   │   └── Sidebar.tsx
│   │   │   ├── layout/
│   │   │   │   ├── Header.tsx
│   │   │   │   ├── Layout.tsx
│   │   │   │   └── Navigation.tsx
│   │   │   ├── rubric/
│   │   │   │   ├── RubricBuilder.tsx
│   │   │   │   ├── CriterionRow.tsx
│   │   │   │   └── RubricPreview.tsx
│   │   │   ├── grading/
│   │   │   │   ├── GradingPanel.tsx
│   │   │   │   ├── SubmissionViewer.tsx
│   │   │   │   └── FeedbackEditor.tsx
│   │   │   └── dashboard/
│   │   │       ├── StatsCard.tsx
│   │   │       └── ActivityFeed.tsx
│   │   ├── pages/
│   │   │   ├── Dashboard.tsx
│   │   │   ├── Classes.tsx
│   │   │   ├── Rubrics.tsx
│   │   │   ├── Assignments.tsx
│   │   │   ├── GradeCenter.tsx
│   │   │   ├── Settings.tsx
│   │   │   └── Login.tsx
│   │   ├── hooks/
│   │   │   ├── useAuth.ts
│   │   │   ├── useRubrics.ts
│   │   │   └── useGrading.ts
│   │   ├── services/
│   │   │   ├── api.ts
│   │   │   ├── auth.ts
│   │   │   └── grading.ts
│   │   ├── types/
│   │   │   └── index.ts
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── package.json
│   └── tailwind.config.js
│
├── backend/
│   ├── src/
│   │   ├── controllers/
│   │   │   ├── authController.ts
│   │   │   ├── classController.ts
│   │   │   ├── rubricController.ts
│   │   │   ├── assignmentController.ts
│   │   │   └── gradingController.ts
│   │   ├── models/
│   │   │   ├── User.ts
│   │   │   ├── Class.ts
│   │   │   ├── Student.ts
│   │   │   ├── Rubric.ts
│   │   │   ├── Assignment.ts
│   │   │   ├── Submission.ts
│   │   │   └── Grade.ts
│   │   ├── services/
│   │   │   ├── aiGrading.ts          # AI API integration
│   │   │   ├── fileParser.ts         # PDF/DOCX extraction
│   │   │   └── emailService.ts       # Grade distribution
│   │   ├── middleware/
│   │   │   ├── auth.ts
│   │   │   └── upload.ts
│   │   ├── routes/
│   │   │   ├── auth.ts
│   │   │   ├── classes.ts
│   │   │   ├── rubrics.ts
│   │   │   ├── assignments.ts
│   │   │   └── grading.ts
│   │   ├── utils/
│   │   │   ├── promptBuilder.ts      # Rubric-to-prompt conversion
│   │   │   └── validators.ts
│   │   └── index.ts
│   ├── prisma/
│   │   └── schema.prisma             # Database schema
│   └── package.json
│
├── docs/
│   ├── API.md
│   └── SETUP.md
│
├── .env.example
├── docker-compose.yml
├── README.md
└── plan.txt

--------------------------------------------------------------------------------
6. DEVELOPMENT PHASES & MILESTONES
--------------------------------------------------------------------------------

PHASE 0: Project Setup (Foundation)
  - Initialize React frontend with Vite + TypeScript
  - Set up Express/Node backend
  - Configure PostgreSQL with Prisma ORM
  - Implement user authentication (register/login)
  - Create basic layout with sidebar navigation
  - Class/assignment CRUD basics

================================================================================
  PRIORITY IMPLEMENTATION ORDER
================================================================================

PHASE 1: RUBRIC UPLOAD PIPELINE  [PRIORITY 1]
  - File upload endpoint for rubrics (PDF, DOCX, XLSX, CSV, images)
  - Text/structure extraction from uploaded files
  - AI parsing to identify: criteria names, descriptions, point values
  - Review UI: teacher confirms/edits extracted rubric
  - Save parsed rubric to database
  - Manual rubric builder as fallback (if upload parsing fails)
  - Rubric library: reuse across multiple assignments

PHASE 2: STUDENT WORK UPLOAD PIPELINE  [PRIORITY 2]
  - File upload endpoint (PDF, DOCX, TXT, code files)
  - Text extraction and storage
  - Bulk upload (ZIP containing multiple files)
  - Student roster import (CSV with names/emails)
  - Match submissions to students (by filename or manual)
  - Submission status tracking (uploaded, pending, graded)

PHASE 3: GRADING PIPELINE  [PRIORITY 3]
  - AI API connection (Anthropic/OpenAI)
  - Prompt engineering: convert rubric + submission to grading prompt
  - Per-criterion scoring with specific feedback
  - Overall feedback generation
  - Store grades linked to submissions and rubric criteria
  - Batch processing queue for multiple submissions
  - Progress indicator during grading

================================================================================
  SECONDARY PHASES (After Core Pipeline Works)
================================================================================

PHASE 4: Review & Polish
  - Teacher review/approval workflow
  - Grade override and manual editing
  - Export functionality (CSV/Excel)
  - Dashboard analytics
  - UI polish and responsive design

PHASE 5: Distribution & Future
  - Email grade distribution
  - Student portal (view-only access)
  - LMS integration consideration (Canvas, Blackboard API)
  - Plagiarism detection integration (optional)

--------------------------------------------------------------------------------
7. RUBRIC UPLOAD PIPELINE (DETAILED)
--------------------------------------------------------------------------------

Teachers already have rubrics in various formats. The system must intelligently
parse these into a structured format.

Supported Input Formats:
  - PDF (most common - exported from Word, LMS, etc.)
  - DOCX/DOC (Word documents)
  - XLSX/CSV (spreadsheet rubrics with rows/columns)
  - Images (PNG, JPG - scanned or screenshot rubrics)
  - Plain text / Markdown

Extraction Process:
  1. UPLOAD: Teacher uploads rubric file
  2. EXTRACT: System extracts raw text/structure
     - PDF: pdf-parse or pdfjs
     - DOCX: mammoth.js
     - Excel: xlsx library
     - Images: OCR via Tesseract or cloud vision API
  3. AI PARSE: Send extracted content to AI with prompt:
     ```
     Parse this rubric into structured JSON. Extract:
     - Rubric title
     - Each criterion with:
       - Name
       - Description/expectations
       - Point value (or weight)
       - Performance levels if present (Excellent/Good/Fair/Poor)

     Raw rubric content:
     {extracted_text}
     ```
  4. REVIEW: Display parsed rubric to teacher for confirmation
     - Show side-by-side: original file | parsed structure
     - Allow inline editing of any field
     - Add/remove criteria as needed
  5. SAVE: Store confirmed rubric in database

Rubric Database Schema:
  rubrics
    - id, user_id, name, description, source_file_path, created_at

  criteria
    - id, rubric_id, name, description, max_points, order

  performance_levels (optional, for detailed rubrics)
    - id, criterion_id, level_name, level_description, points

UI Flow:
  +---------------------------------------------------------------+
  |  Upload Rubric                                                 |
  +---------------------------------------------------------------+
  |  [Drag & drop file here or click to browse]                   |
  |  Supported: PDF, Word, Excel, Images                          |
  +---------------------------------------------------------------+
            |
            v
  +---------------------------------------------------------------+
  |  Parsing Rubric...  [===========         ] 60%                |
  +---------------------------------------------------------------+
            |
            v
  +---------------------------------------------------------------+
  |  Review Extracted Rubric                    [Save] [Re-upload]|
  +---------------------------------------------------------------+
  |  Original File          |  Extracted Structure                |
  |  [PDF Preview]          |  Name: [Argumentative Essay Rubric] |
  |                         |                                     |
  |                         |  Criteria:                          |
  |                         |  1. Thesis Statement    [25] pts    |
  |                         |     [Clear, arguable claim...]      |
  |                         |  2. Evidence & Support  [25] pts    |
  |                         |     [Relevant examples...]          |
  |                         |  [+ Add Criterion]                  |
  +---------------------------------------------------------------+

--------------------------------------------------------------------------------
8. STUDENT WORK UPLOAD PIPELINE (DETAILED)
--------------------------------------------------------------------------------

Input Methods:
  - Single file upload (one student at a time)
  - Bulk upload via ZIP file
  - Folder drag-and-drop (multiple files)

Supported File Types:
  - Documents: PDF, DOCX, DOC, TXT, RTF
  - Code: .py, .java, .js, .cpp, .c, .html, .css (syntax-aware)
  - Spreadsheets: XLSX, CSV (for data-based assignments)

Student Matching:
  - By filename convention: "LastName_FirstName_Assignment.pdf"
  - By roster: Upload CSV with student info, then match files
  - Manual: Teacher assigns uploaded files to students

Workflow:
  1. Teacher selects assignment
  2. Uploads file(s)
  3. System extracts text content
  4. System attempts to match to students (if roster exists)
  5. Teacher confirms/fixes matches
  6. Submissions marked as "Ready for Grading"

UI Flow:
  +---------------------------------------------------------------+
  |  Upload Submissions for: [Midterm Essay]                      |
  +---------------------------------------------------------------+
  |  [Drag files here or click to browse]                         |
  |  Or upload ZIP file for bulk import                           |
  +---------------------------------------------------------------+
  |  Uploaded Files (12)                        [Match to Roster] |
  +---------------------------------------------------------------+
  |  Filename                    | Matched Student | Status       |
  +-----------------------------+-----------------+--------------+
  |  Smith_John_Essay.pdf       | John Smith      | Ready        |
  |  jane_doe_final.pdf         | Jane Doe        | Ready        |
  |  essay_v2.pdf               | [Select...]     | Needs Match  |
  +-----------------------------+-----------------+--------------+
  |                                      [Confirm & Start Grading]|
  +---------------------------------------------------------------+

--------------------------------------------------------------------------------
9. AI GRADING APPROACH
--------------------------------------------------------------------------------

Prompt Template Structure:
```
You are an experienced educator grading a student submission.

RUBRIC:
{rubric_criteria_with_descriptions}

STUDENT SUBMISSION:
{extracted_text}

For each criterion, provide:
1. Score (out of max points)
2. Specific feedback citing evidence from the submission
3. Suggestions for improvement

Finally, provide overall feedback summarizing strengths and areas for growth.

Respond in JSON format:
{
  "criteria_scores": [
    {"criterion": "...", "score": X, "feedback": "..."},
    ...
  ],
  "total_score": X,
  "overall_feedback": "..."
}
```

Key Considerations:
  - Consistency: Same rubric should yield similar grades for similar work
  - Transparency: AI must cite specific evidence for scores
  - Teacher Override: All AI grades are suggestions until approved
  - Edge Cases: Flag low-confidence scores for manual review

--------------------------------------------------------------------------------
10. SECURITY CONSIDERATIONS
--------------------------------------------------------------------------------

  - Password hashing with bcrypt (min 12 rounds)
  - JWT tokens with short expiry + refresh tokens
  - File upload validation (type, size limits)
  - Sanitize extracted text before AI processing
  - Rate limiting on API endpoints
  - CORS configuration for production
  - Environment variables for all secrets (never commit .env)
  - FERPA compliance considerations for student data

--------------------------------------------------------------------------------
11. FUTURE ENHANCEMENTS
--------------------------------------------------------------------------------

  - Multi-user collaboration (TAs, co-teachers)
  - Rubric templates library
  - Grade analytics and trends over time
  - Student self-assessment before submission
  - Peer review workflows
  - Integration with Google Classroom, Canvas, Blackboard
  - Mobile-responsive design / PWA
  - Offline grading capability
  - Handwriting recognition for scanned assignments

--------------------------------------------------------------------------------
12. GETTING STARTED (Next Steps)
--------------------------------------------------------------------------------

1. Initialize the repository structure
2. Set up frontend with React + Vite + Tailwind
3. Set up backend with Express + Prisma
4. Create database schema and run migrations
5. Build authentication flow (basic)
6. [PRIORITY 1] Implement rubric upload + AI parsing
7. [PRIORITY 2] Implement student work upload pipeline
8. [PRIORITY 3] Integrate AI API for grading pipeline
9. Build teacher review/approval workflow
10. Test end-to-end grading pipeline

================================================================================
                              END OF PLAN
================================================================================
